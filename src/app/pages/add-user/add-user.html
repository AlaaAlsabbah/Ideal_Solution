@if (isLoading) {
  <div class="skeleton-container">
    <div class="page-header gap-2">
      <div class="d-flex align-items-center gap-3">
        <p-skeleton shape="circle" size="2rem" styleClass="fade-in"></p-skeleton>
        <div class="title">
          <p-skeleton width="10rem" height="1.5rem" class="mb-0 fade-in"></p-skeleton>
          <p-skeleton width="5rem" height="0.8rem" class="fade-in mt-1"></p-skeleton>
        </div>
      </div>
      <div class="p-formgroup-inline">
        <p-skeleton width="5rem" height="2rem" class="fade-in"></p-skeleton>
        <p-skeleton width="5rem" height="2rem" class="fade-in"></p-skeleton>
      </div>
    </div>

    <div class="container">
      <div class="p-field fileUpload">
        <p-skeleton shape="rectangle" width="200px" height="200px" class="fade-in"></p-skeleton>
        <p-skeleton width="8rem" height="2rem" class="fade-in mt-2"></p-skeleton>
      </div>

      <div class="row">
        @for (field of skeletonFields; track $index) {
          <div [ngClass]="field.colClass">
            <div class="p-field">
              <p-skeleton width="6rem" height="1rem" class="mb-2 fade-in"></p-skeleton>
              <p-skeleton width="100%" height="2.5rem" class="fade-in"></p-skeleton>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
} @else {
  <div>
    <div class="page-header gap-2">
      <div class="d-flex align-items-center gap-3">
        <button pButton type="button" icon="icon-arrow-left2" class="p-button-text" (click)="onCancel()"></button>
        <div class="title">
          <h2 class="mb-0">Add User</h2>
          <small class="d-block"> Organization </small>
        </div>
      </div>

      <div class="p-formgroup-inline">
        <p-button type="button" label="Cancel" class="p-button-secondary" (click)="onCancel()"></p-button>
        <p-button type="submit" label="Save" [disabled]="!userForm.valid" severity="success" (click)="onSubmit()" />
      </div>
    </div>

    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
      <div class="container">
        <div class="p-field fileUpload">
          <div class="image-preview">
            @if (uploadedImage) {
              <img [src]="uploadedImage" alt="Preview" />
            } @else {
              <div class="placeholder-text">No image uploaded</div>
            }
          </div>
          <p-fileUpload mode="basic" chooseLabel="Update Image" chooseIcon="icon-camera" accept="image/*"
            [auto]="true" [customUpload]="true" [maxFileSize]="1000000"
            (uploadHandler)="onImageUpload($event)">
          </p-fileUpload>
        </div>

        <div class="row">
          <div class="col-md-4">
            <div class="p-field">
              <label for="firstName">First Name <span class="text-danger"> * </span></label>
              <input id="firstName" type="text" pInputText formControlName="firstName">
              @if (userForm.get('firstName')?.touched && userForm.get('firstName')?.invalid) {
                <div class="error-message">
                  @if (userForm.get('firstName')?.hasError('required')) {
                    <div>This field is required</div>
                  }
                  @if (userForm.get('firstName')?.hasError('minlength')) {
                    <div>Must be at least 2 characters</div>
                  }
                </div>
              }
            </div>
          </div>

          <div class="col-md-4">
            <div class="p-field">
              <label for="middleName">Middle Name</label>
              <input id="middleName" type="text" pInputText formControlName="middleName">
            </div>
          </div>

          <div class="col-md-4">
            <div class="p-field">
              <label for="lastName">Last Name <span class="text-danger"> * </span></label>
              <input id="lastName" type="text" pInputText formControlName="lastName">
              @if (userForm.get('lastName')?.touched && userForm.get('lastName')?.invalid) {
                <div class="error-message">
                  @if (userForm.get('lastName')?.hasError('required')) {
                    <div>This field is required</div>
                  }
                  @if (userForm.get('lastName')?.hasError('minlength')) {
                    <div>Must be at least 2 characters</div>
                  }
                </div>
              }
            </div>
          </div>

          <div class="col-md-12">
            <div class="p-field">
              <label for="email">Email <span class="text-danger"> * </span></label>
              <input id="email" type="email" pInputText formControlName="email">
              @if (userForm.get('email')?.touched && userForm.get('email')?.invalid) {
                <div class="error-message">
                  @if (userForm.get('email')?.hasError('required')) {
                    <div>This field is required</div>
                  }
                  @if (userForm.get('email')?.hasError('email')) {
                    <div>Invalid email format</div>
                  }
                </div>
              }
            </div>
          </div>

          <div class="col-md-12">
            <div class="p-field">
              <label for="phone">Phone</label>
              <p-inputMask id="phone" mask="(999) 999-9999" formControlName="phone"></p-inputMask>
            </div>
          </div>

          <div class="col-md-12">
            <div class="p-field">
              <label for="rfid">RFID</label>
              <input id="rfid" type="text" pInputText formControlName="rfid">
            </div>
          </div>

          <div class="col-md-12">
            <div class="p-field">
              <label for="role">Role <span class="text-danger"> * </span></label>
              <select id="role" formControlName="role" required>
                <option value="">Select a Role</option>
                @for (role of roles; track role.value) {
                  <option [value]="role.value">{{ role.label }}</option>
                }
              </select>
              @if (userForm.get('role')?.touched && userForm.get('role')?.hasError('required')) {
                <div class="error-message">This field is required</div>
              }
            </div>
          </div>

          <div class="col-md-12">
            <div class="p-field">
              <label for="department">Department <span class="text-danger"> * </span></label>
              <select id="department" formControlName="department" required>
                <option value="">Select a Department</option>
                @for (dept of departments; track dept.value) {
                  <option [value]="dept.value">{{ dept.label }}</option>
                }
              </select>
              @if (userForm.get('department')?.touched && userForm.get('department')?.hasError('required')) {
                <div class="error-message">This field is required</div>
              }
            </div>
          </div>

          <div class="col-md-12">
            <div class="p-field">
              <label for="fleet">Fleet</label>
              <input id="fleet" type="text" pInputText formControlName="fleet">
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
}
